
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Module 4: Simulating Simple 1D Systems &#8212; Molecular Dynamics Tutorial for Beginners</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_build/jupyter_execute/notebooks/4_1D_simulations';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Molecular Dynamics Tutorial for Beginners</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Molecular Dynamics Tutorial for Beginners
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/1_intro_to_MD.html">Module 1: Introduction to Molecular Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/2_physics_of_MD.html">Module 2: The Physics Behind MD</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/3_non_bonded_interactions.html">Module 3: Non-Bonded Interactions and Long-Range Electrostatics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/4_1D_simulations.html">Module 4: Simulating Simple 1D Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/5_sampling_challenge.html">Module 5: The Challenge of Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/5.5_chossing_CVs.html">Lesson 5.2a: Choosing Good Collective Variables for Multi-Dimensional Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/6_umbrella_sampling.html">Module 6: Enhanced Sampling I - Umbrella Sampling (US) &amp; PMF Reconstruction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/6.1_WHAM_detailed.html">WHAM, step by step (with plots)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/7_meta_dynamics.html">Module 7: Enhanced Sampling II - Metadynamics (MetaD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/8_ase_LJ_fluid_simulation.html">Module 8: Multi-Particle Simulations: Lennard-Jones Fluid with ASE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/9_ase_waterbox_simulation_not_working.html">Module 9: Simulating Molecular Systems: Water Box with ASE</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/YOUR_USERNAME/YOUR_REPO/main?urlpath=lab/tree/./_build/jupyter_execute/notebooks/4_1D_simulations.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/YOUR_USERNAME/YOUR_REPO" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/YOUR_USERNAME/YOUR_REPO/issues/new?title=Issue%20on%20page%20%2F_build/jupyter_execute/notebooks/4_1D_simulations.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/_build/jupyter_execute/notebooks/4_1D_simulations.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Module 4: Simulating Simple 1D Systems</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-importing-libraries">Setup: Importing Libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lesson-3-1-particle-in-a-simple-harmonic-potential-nve">Lesson 3.1: Particle in a Simple Harmonic Potential (NVE)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-potential-and-force-functions">Defining the Potential and Force Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-the-velocity-verlet-integrator">Implementing the Velocity Verlet Integrator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-simulation-parameters-and-initial-conditions">Setting Simulation Parameters and Initial Conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-exercise-running-the-nve-simulation-loop">Coding Exercise: Running the NVE Simulation Loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-exercise-plotting-the-results">Analysis Exercise: Plotting the Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lesson-3-2-adding-temperature-control-nvt-with-langevin-dynamics">Lesson 3.2: Adding Temperature Control (NVT) with Langevin Dynamics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-temperature-calculation-and-langevin-integrator">Implementing Temperature Calculation and Langevin Integrator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-exercise-running-the-nvt-simulation-loop-langevin">Coding Exercise: Running the NVT Simulation Loop (Langevin)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-exercise-nvt-langevin-simulation-results">Analysis Exercise: NVT (Langevin) Simulation Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lesson-3-3-particle-in-a-double-well-potential-nve">Lesson 3.3: Particle in a Double-Well Potential (NVE)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-double-well-potential-and-force">Defining the Double-Well Potential and Force</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-exercise-running-the-nve-simulation-for-the-double-well">Coding Exercise: Running the NVE Simulation for the Double-Well</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-exercise-double-well-nve-results">Analysis Exercise: Double-Well NVE Results</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="module-4-simulating-simple-1d-systems">
<h1>Module 4: Simulating Simple 1D Systems<a class="headerlink" href="#module-4-simulating-simple-1d-systems" title="Link to this heading">#</a></h1>
<p>Now that we understand the basic physics and algorithms (Newton’s laws, potential energy, Verlet integration), let’s put them into practice! In this module, we will write Python code to simulate the motion of a single particle in one dimension (1D) under the influence of simple potential energy functions. This will allow us to solidify our understanding of the core MD loop and basic analysis techniques before tackling more complex systems or concepts.</p>
<p>We’ll start with the simplest oscillating system: the Simple Harmonic Oscillator.</p>
<section id="setup-importing-libraries">
<h2>Setup: Importing Libraries<a class="headerlink" href="#setup-importing-libraries" title="Link to this heading">#</a></h2>
<p>First, let’s import the necessary Python libraries: <code class="docutils literal notranslate"><span class="pre">NumPy</span></code> for numerical operations and <code class="docutils literal notranslate"><span class="pre">Matplotlib</span></code> for plotting our results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Plotting style configuration (optional)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-v0_8-darkgrid&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># Default figure size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;lines.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="lesson-3-1-particle-in-a-simple-harmonic-potential-nve">
<h2>Lesson 3.1: Particle in a Simple Harmonic Potential (NVE)<a class="headerlink" href="#lesson-3-1-particle-in-a-simple-harmonic-potential-nve" title="Link to this heading">#</a></h2>
<p>The Simple Harmonic Oscillator (SHO) is a fundamental model in physics. It describes a system where the restoring force is directly proportional to the displacement from an equilibrium position. Think of a mass attached to a spring.</p>
<p><strong>Potential Energy:</strong>
The potential energy <span class="math notranslate nohighlight">\(V(x)\)</span> for a 1D SHO is given by:
$<span class="math notranslate nohighlight">\( V(x) = \frac{1}{2} k x^2 \)</span><span class="math notranslate nohighlight">\(
where \)</span>k<span class="math notranslate nohighlight">\( is the spring constant (determining the stiffness) and \)</span>x<span class="math notranslate nohighlight">\( is the displacement from the equilibrium position (\)</span>x=0$).</p>
<p><strong>Force:</strong>
The force <span class="math notranslate nohighlight">\(F(x)\)</span> is the negative derivative of the potential energy with respect to position:
$<span class="math notranslate nohighlight">\( F(x) = -\frac{dV}{dx} = -k x \)</span><span class="math notranslate nohighlight">\(
The negative sign indicates that it's a restoring force, always pulling the particle back towards \)</span>x=0$.</p>
<p>We will simulate this system in the <strong>Microcanonical (NVE) ensemble</strong>, meaning we expect the total energy (kinetic + potential) to be conserved throughout the simulation (within numerical accuracy).</p>
<section id="defining-the-potential-and-force-functions">
<h3>Defining the Potential and Force Functions<a class="headerlink" href="#defining-the-potential-and-force-functions" title="Link to this heading">#</a></h3>
<p>Let’s write Python functions for the SHO potential energy and force.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">potential_sh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Calculates the potential energy of a simple harmonic oscillator.&quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">force_sh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Calculates the force on a particle in a simple harmonic potential.&quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="implementing-the-velocity-verlet-integrator">
<h3>Implementing the Velocity Verlet Integrator<a class="headerlink" href="#implementing-the-velocity-verlet-integrator" title="Link to this heading">#</a></h3>
<p>Now, let’s implement the Velocity Verlet algorithm we discussed in Module 2. This function will take the current position, velocity, mass, time step, and the force function as input, and return the updated position and velocity. This integrator is suitable for NVE simulations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">velocity_verlet_step</span><span class="p">(</span><span class="n">x_curr</span><span class="p">,</span> <span class="n">v_curr</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">force_func</span><span class="p">,</span> <span class="o">**</span><span class="n">force_args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs one step of the Velocity Verlet algorithm in 1D (for NVE)</span>
<span class="sd">    using half-step velocity updates.</span>

<span class="sd">    Args:</span>
<span class="sd">        x_curr (float): Current position.</span>
<span class="sd">        v_curr (float): Current velocity.</span>
<span class="sd">        mass (float): Mass of the particle.</span>
<span class="sd">        dt (float): Time step.</span>
<span class="sd">        force_func (callable): Function to calculate force; it should accept</span>
<span class="sd">                               position `x` as the first argument, followed</span>
<span class="sd">                               by any potential parameters (e.g., k).</span>
<span class="sd">        **force_args: Additional keyword arguments for the force function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (x_new, v_new) - Updated position and velocity.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># 1. Compute force &amp; acceleration at current position</span>
    <span class="n">f_curr</span> <span class="o">=</span> <span class="n">force_func</span><span class="p">(</span><span class="n">x_curr</span><span class="p">,</span> <span class="o">**</span><span class="n">force_args</span><span class="p">)</span>
    <span class="n">a_curr</span> <span class="o">=</span> <span class="n">f_curr</span> <span class="o">/</span> <span class="n">mass</span>

    <span class="c1"># 2. Half-step velocity update</span>
    <span class="n">v_half</span> <span class="o">=</span> <span class="n">v_curr</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">a_curr</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="c1"># 3. Full position update using half-step velocity</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">x_curr</span> <span class="o">+</span> <span class="n">v_half</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="c1"># 4. Compute force &amp; acceleration at new position</span>
    <span class="n">f_new</span> <span class="o">=</span> <span class="n">force_func</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="o">**</span><span class="n">force_args</span><span class="p">)</span>
    <span class="n">a_new</span> <span class="o">=</span> <span class="n">f_new</span> <span class="o">/</span> <span class="n">mass</span>

    <span class="c1"># 5. Complete velocity update with new acceleration</span>
    <span class="n">v_new</span> <span class="o">=</span> <span class="n">v_half</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">a_new</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="k">return</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">v_new</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="setting-simulation-parameters-and-initial-conditions">
<h3>Setting Simulation Parameters and Initial Conditions<a class="headerlink" href="#setting-simulation-parameters-and-initial-conditions" title="Link to this heading">#</a></h3>
<p>We need to define the parameters for our simulation:</p>
<ul class="simple">
<li><p>Mass of the particle (<code class="docutils literal notranslate"><span class="pre">mass</span></code>)</p></li>
<li><p>Spring constant (<code class="docutils literal notranslate"><span class="pre">k</span></code>)</p></li>
<li><p>Time step (<code class="docutils literal notranslate"><span class="pre">dt</span></code>) - Needs to be small enough to capture the oscillation period accurately.</p></li>
<li><p>Total number of simulation steps (<code class="docutils literal notranslate"><span class="pre">n_steps</span></code>)</p></li>
<li><p>Initial position (<code class="docutils literal notranslate"><span class="pre">x0</span></code>)</p></li>
<li><p>Initial velocity (<code class="docutils literal notranslate"><span class="pre">v0</span></code>)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulation parameters</span>
<span class="n">mass</span> <span class="o">=</span> <span class="mf">1.0</span>      <span class="c1"># Mass of the particle (arbitrary units)</span>
<span class="n">k_sh</span> <span class="o">=</span> <span class="mf">1.0</span>      <span class="c1"># Spring constant for SHO (arbitrary units)</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>       <span class="c1"># Time step (smaller is generally more accurate but slower)</span>
<span class="n">n_steps</span> <span class="o">=</span> <span class="mi">5000</span>  <span class="c1"># Total number of simulation steps</span>
<span class="n">total_time</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">n_steps</span>

<span class="c1"># Initial conditions</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">1.0</span>        <span class="c1"># Initial position</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mf">0.0</span>        <span class="c1"># Initial velocity</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total simulation time: </span><span class="si">{</span><span class="n">total_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total simulation time: 50.00
</pre></div>
</div>
</div>
</div>
</section>
<section id="coding-exercise-running-the-nve-simulation-loop">
<h3>Coding Exercise: Running the NVE Simulation Loop<a class="headerlink" href="#coding-exercise-running-the-nve-simulation-loop" title="Link to this heading">#</a></h3>
<p>Now, use the <code class="docutils literal notranslate"><span class="pre">velocity_verlet_step</span></code> function within a loop to run the simulation for <code class="docutils literal notranslate"><span class="pre">n_steps</span></code>. Store the time, position, and velocity at each step. Also, calculate and store the kinetic, potential, and total energy at each step.</p>
<ul class="simple">
<li><p>Kinetic Energy: <span class="math notranslate nohighlight">\( E_K = \frac{1}{2} m v^2 \)</span></p></li>
<li><p>Potential Energy: <span class="math notranslate nohighlight">\( V(x) = \frac{1}{2} k x^2 \)</span></p></li>
<li><p>Total Energy: <span class="math notranslate nohighlight">\( E_{total} = E_K + V(x) \)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- NVE Simulation Loop ---</span>

<span class="c1"># Arrays to store results</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>
<span class="n">velocities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>
<span class="n">kinetic_energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>
<span class="n">potential_energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>
<span class="n">total_energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>

<span class="c1"># Set initial values</span>
<span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span>
<span class="n">velocities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>

<span class="c1"># Calculate initial energies</span>
<span class="n">kinetic_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">velocities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="n">potential_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">potential_sh</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="n">k_sh</span><span class="p">)</span>
<span class="n">total_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinetic_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">potential_energies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Run the simulation loop</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Perform one Verlet step</span>
    <span class="n">x_new</span><span class="p">,</span> <span class="n">v_new</span> <span class="o">=</span> <span class="n">velocity_verlet_step</span><span class="p">(</span>
        <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">velocities</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mass</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">force_sh</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_sh</span>
    <span class="p">)</span>

    <span class="c1"># Store new values</span>
    <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
    <span class="n">velocities</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_new</span>
    <span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span>

    <span class="c1"># Calculate and store energies for the new state</span>
    <span class="n">kinetic_energies</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">v_new</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">potential_energies</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">potential_sh</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_sh</span><span class="p">)</span>
    <span class="n">total_energies</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinetic_energies</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">potential_energies</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NVE Simulation finished.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NVE Simulation finished.
</pre></div>
</div>
</div>
</div>
</section>
<section id="analysis-exercise-plotting-the-results">
<h3>Analysis Exercise: Plotting the Results<a class="headerlink" href="#analysis-exercise-plotting-the-results" title="Link to this heading">#</a></h3>
<p>Visualize the simulation results:</p>
<ol class="arabic simple">
<li><p>Plot position vs. time. Does it look like harmonic motion?</p></li>
<li><p>Plot velocity vs. time. How does it relate to the position plot?</p></li>
<li><p>Plot the phase space trajectory (velocity vs. position). What shape do you expect for an SHO?</p></li>
<li><p>Plot kinetic, potential, and total energy vs. time. Is the total energy conserved? How much does it fluctuate? (This fluctuation is related to the numerical error of the integrator and the time step size).</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Plotting NVE Results ---</span>

<span class="c1"># 1. Position vs Time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Position&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;NVE Simple Harmonic Oscillator: Position vs Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Velocity vs Time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Velocity&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;NVE Simple Harmonic Oscillator: Velocity vs Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 3. Phase Space (Velocity vs Position)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Position&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Velocity&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;NVE Simple Harmonic Oscillator: Phase Space&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span> <span class="c1"># Make aspect ratio equal</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 4. Energies vs Time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">kinetic_energies</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Kinetic Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">potential_energies</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Potential Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">total_energies</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;NVE Simple Harmonic Oscillator: Energy Conservation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Optional: Zoom in on total energy to see fluctuations</span>
<span class="c1"># energy_fluctuation = total_energies - total_energies[0]</span>
<span class="c1"># plt.figure()</span>
<span class="c1"># plt.plot(times, energy_fluctuation)</span>
<span class="c1"># plt.title(&quot;Total Energy Fluctuation&quot;)</span>
<span class="c1"># plt.xlabel(&quot;Time&quot;); plt.ylabel(&quot;Delta E&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/790611727d5bd4f57e4fd0e218454e5c61d239b134d1c0531f761211a507ffa7.png" src="../../../_images/790611727d5bd4f57e4fd0e218454e5c61d239b134d1c0531f761211a507ffa7.png" />
<img alt="../../../_images/624c7295bb858bcc140b2661f49dec5e80050405901393b2e4e4b10b22b2c18e.png" src="../../../_images/624c7295bb858bcc140b2661f49dec5e80050405901393b2e4e4b10b22b2c18e.png" />
<img alt="../../../_images/5b089d6ee286d7a958a6761807eb87ea903780623c447b9718b47c2cf919b1bb.png" src="../../../_images/5b089d6ee286d7a958a6761807eb87ea903780623c447b9718b47c2cf919b1bb.png" />
<img alt="../../../_images/41149c6e92a4fcf7b3773d09fb2117efbecb1778581375f5289c83a3edb28517.png" src="../../../_images/41149c6e92a4fcf7b3773d09fb2117efbecb1778581375f5289c83a3edb28517.png" />
</div>
</div>
</section>
</section>
<section id="lesson-3-2-adding-temperature-control-nvt-with-langevin-dynamics">
<h2>Lesson 3.2: Adding Temperature Control (NVT) with Langevin Dynamics<a class="headerlink" href="#lesson-3-2-adding-temperature-control-nvt-with-langevin-dynamics" title="Link to this heading">#</a></h2>
<p>In the NVE simulation, total energy is conserved but temperature fluctuates. To sample the canonical ensemble, we add friction and random forces to Newton’s law:</p>
<div class="math notranslate nohighlight">
\[
  m\ddot{x} = F_{\rm phys}(x)\;-\;\gamma m\dot{x}\;+\;R(t),
  \quad
  \langle R(t)R(t')\rangle = 2m\gamma k_B T_0\,\delta(t-t').
\]</div>
<p><strong>Integration Scheme (modified Velocity Verlet Algorithm):</strong></p>
<ol class="arabic">
<li><p><strong>Half-step velocity (physical force):</strong><br />
$<span class="math notranslate nohighlight">\(
  v \;\leftarrow\; v \;+\;\frac{F_{\rm phys}(x)}{m}\,\frac{\Delta t}{2}
\)</span>$</p></li>
<li><p><strong>Half-step position:</strong><br />
$<span class="math notranslate nohighlight">\(
  x \;\leftarrow\; x \;+\; v\,\frac{\Delta t}{2}
\)</span>$</p></li>
<li><p><strong>Full-step velocity (friction + random):</strong><br />
Define<br />
$<span class="math notranslate nohighlight">\(
  c_1 = e^{-\gamma\,\Delta t},
  \quad
  c_2 = \sqrt{ \frac{k_B T_0}{m}(1 - c_1^2) }.
\)</span><span class="math notranslate nohighlight">\(  
Then  
\)</span><span class="math notranslate nohighlight">\(
  v \;\leftarrow\; c_1\,v \;+\; c_2\,\mathbf{N}(0,1)
\)</span>$</p>
<p>where <span class="math notranslate nohighlight">\(\mathbf{N}(0,1)\)</span> is a random number from a standard normal distribution.</p>
</li>
<li><p><strong>Second half-step position:</strong><br />
$<span class="math notranslate nohighlight">\(
  x \;\leftarrow\; x \;+\; v\,\frac{\Delta t}{2}
\)</span>$</p></li>
<li><p><strong>Second half-step velocity (physical force):</strong><br />
$<span class="math notranslate nohighlight">\(
  v \;\leftarrow\; v \;+\;\frac{F_{\rm phys}(x)}{m}\,\frac{\Delta t}{2}
\)</span>$</p></li>
</ol>
<p><strong>Instantaneous Temperature (1D):</strong><br />
$<span class="math notranslate nohighlight">\(
  T \;=\;\frac{m\,v^2}{k_B}\quad(\text{take }k_B=1).
\)</span>$</p>
<section id="implementing-temperature-calculation-and-langevin-integrator">
<h3>Implementing Temperature Calculation and Langevin Integrator<a class="headerlink" href="#implementing-temperature-calculation-and-langevin-integrator" title="Link to this heading">#</a></h3>
<p>Let’s define the temperature calculation function and the BAOAB integration step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assume Boltzmann constant k_B = 1 for simplicity in reduced units</span>
<span class="n">k_B</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">calculate_temperature_1d</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">mass</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Calculates instantaneous temperature for a 1D particle (kB=1).&quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="n">mass</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="mf">0.0</span> <span class="c1"># Avoid division by zero if mass is invalid</span>
  <span class="n">kinetic_energy</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">velocity</span><span class="o">**</span><span class="mi">2</span>
  <span class="c1"># For 1D, N_df = 1. KE = 0.5 * N_df * kB * T =&gt; T = 2 * KE / (N_df * kB)</span>
  <span class="n">temperature</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">kinetic_energy</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">k_B</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">temperature</span>

<span class="k">def</span><span class="w"> </span><span class="nf">Velocity_verlet_langevin</span><span class="p">(</span><span class="n">x_curr</span><span class="p">,</span> <span class="n">v_curr</span><span class="p">,</span> <span class="n">mass</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">target_temp</span><span class="p">,</span> <span class="n">force_func</span><span class="p">,</span> <span class="o">**</span><span class="n">force_args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        x_curr (float): Current position.</span>
<span class="sd">        v_curr (float): Current velocity.</span>
<span class="sd">        mass (float): Mass of the particle.</span>
<span class="sd">        dt (float): Time step.</span>
<span class="sd">        gamma (float): Friction coefficient.</span>
<span class="sd">        target_temp (float): Target temperature (kB=1).</span>
<span class="sd">        force_func (callable): Function to calculate the physical force.</span>
<span class="sd">        **force_args: Additional keyword arguments for the force function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (x_new, v_new) - Updated position and velocity.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Update velocity by half step with current force</span>
    <span class="n">f_curr</span> <span class="o">=</span> <span class="n">force_func</span><span class="p">(</span><span class="n">x_curr</span><span class="p">,</span> <span class="o">**</span><span class="n">force_args</span><span class="p">)</span>
    <span class="n">v_half_b</span> <span class="o">=</span> <span class="n">v_curr</span> <span class="o">+</span> <span class="p">(</span><span class="n">f_curr</span> <span class="o">/</span> <span class="n">mass</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dt</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

    <span class="c1"># Update position by half step</span>
    <span class="n">x_half_a</span> <span class="o">=</span> <span class="n">x_curr</span> <span class="o">+</span> <span class="n">v_half_b</span> <span class="o">*</span> <span class="p">(</span><span class="n">dt</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

    <span class="c1"># Apply friction and random kick</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">gamma</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
    <span class="c1"># Ensure target_temp is non-negative before sqrt</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">k_B</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">target_temp</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">c1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">mass</span><span class="p">)</span>
    <span class="c1"># Generate random number from standard normal distribution</span>
    <span class="n">random_kick</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">v_half_o</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">v_half_b</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">random_kick</span>

    <span class="c1"># Update position by second half step</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">x_half_a</span> <span class="o">+</span> <span class="n">v_half_o</span> <span class="o">*</span> <span class="p">(</span><span class="n">dt</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

    <span class="c1"># Update velocity by half step with force at *new* position</span>
    <span class="n">f_new</span> <span class="o">=</span> <span class="n">force_func</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="o">**</span><span class="n">force_args</span><span class="p">)</span>
    <span class="n">v_new</span> <span class="o">=</span> <span class="n">v_half_o</span> <span class="o">+</span> <span class="p">(</span><span class="n">f_new</span> <span class="o">/</span> <span class="n">mass</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dt</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">x_new</span><span class="p">,</span> <span class="n">v_new</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="coding-exercise-running-the-nvt-simulation-loop-langevin">
<h3>Coding Exercise: Running the NVT Simulation Loop (Langevin)<a class="headerlink" href="#coding-exercise-running-the-nvt-simulation-loop-langevin" title="Link to this heading">#</a></h3>
<p>Modify the simulation loop to use the Langevin BAOAB integrator.</p>
<ol class="arabic simple">
<li><p>Choose a target temperature (<code class="docutils literal notranslate"><span class="pre">target_temp</span></code>) and friction coefficient (<code class="docutils literal notranslate"><span class="pre">gamma</span></code>). A larger gamma means stronger coupling to the heat bath.</p></li>
<li><p>Inside the loop, call <code class="docutils literal notranslate"><span class="pre">langevin_baoab_step</span></code> instead of <code class="docutils literal notranslate"><span class="pre">velocity_verlet_step</span></code>.</p></li>
<li><p>Store the instantaneous temperature at each step.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NVT Langevin Simulation Parameters</span>
<span class="n">target_temp_lgv</span> <span class="o">=</span> <span class="mf">5.0</span>  <span class="c1"># Target temperature (in energy units, kB=1)</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="mf">3.0</span>          <span class="c1"># Friction coefficient (adjust to see effect)</span>

<span class="c1"># Arrays to store NVT results</span>
<span class="n">times_nvt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>
<span class="n">positions_nvt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>
<span class="n">velocities_nvt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>
<span class="n">kinetic_energies_nvt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>
<span class="n">potential_energies_nvt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>
<span class="n">total_energies_nvt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span> <span class="c1"># Note: Total E is NOT conserved in NVT</span>
<span class="n">temperatures_nvt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span> <span class="c1"># Store temperature</span>

<span class="c1"># Set initial values</span>
<span class="n">x0_nvt</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">v0_nvt</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># Can start at rest, Langevin will add energy</span>
<span class="n">positions_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0_nvt</span>
<span class="n">velocities_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0_nvt</span>

<span class="c1"># Calculate initial energies and temperature</span>
<span class="n">kinetic_energies_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">velocities_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
<span class="n">potential_energies_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">potential_sh</span><span class="p">(</span><span class="n">positions_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="n">k_sh</span><span class="p">)</span>
<span class="n">total_energies_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinetic_energies_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">potential_energies_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">temperatures_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_temperature_1d</span><span class="p">(</span><span class="n">velocities_nvt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mass</span><span class="p">)</span>


<span class="c1"># --- NVT Langevin Simulation Loop ---</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting NVT (Langevin) simulation with Target T = </span><span class="si">{</span><span class="n">target_temp_lgv</span><span class="si">}</span><span class="s2">, gamma = </span><span class="si">{</span><span class="n">gamma</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Perform one Langevin BAOAB step</span>
    <span class="n">x_new</span><span class="p">,</span> <span class="n">v_new</span> <span class="o">=</span> <span class="n">Velocity_verlet_langevin</span><span class="p">(</span>
        <span class="n">positions_nvt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">velocities_nvt</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mass</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">target_temp_lgv</span><span class="p">,</span>
        <span class="n">force_sh</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_sh</span>
    <span class="p">)</span>

    <span class="c1"># Store new values</span>
    <span class="n">positions_nvt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
    <span class="n">velocities_nvt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_new</span>
    <span class="n">times_nvt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">times_nvt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span>

    <span class="c1"># Calculate and store energies and temperature using the new state</span>
    <span class="n">kinetic_energies_nvt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">v_new</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">potential_energies_nvt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">potential_sh</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k_sh</span><span class="p">)</span> <span class="c1"># Potential depends on position</span>
    <span class="n">total_energies_nvt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinetic_energies_nvt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">potential_energies_nvt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">temperatures_nvt</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">calculate_temperature_1d</span><span class="p">(</span><span class="n">v_new</span><span class="p">,</span> <span class="n">mass</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NVT (Langevin) Simulation finished.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting NVT (Langevin) simulation with Target T = 5.0, gamma = 3.0
NVT (Langevin) Simulation finished.
</pre></div>
</div>
</div>
</div>
</section>
<section id="analysis-exercise-nvt-langevin-simulation-results">
<h3>Analysis Exercise: NVT (Langevin) Simulation Results<a class="headerlink" href="#analysis-exercise-nvt-langevin-simulation-results" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Plot the instantaneous temperature vs. time. Does it fluctuate around the target temperature? How does the friction coefficient <code class="docutils literal notranslate"><span class="pre">gamma</span></code> affect the fluctuations and the speed of reaching the target temperature? (Try changing <code class="docutils literal notranslate"><span class="pre">gamma</span></code> and re-running).</p></li>
<li><p>Plot the total energy vs. time. Is it conserved? It shouldn’t be, as the thermostat exchanges energy with the system.</p></li>
<li><p>Plot the NVT phase space trajectory (velocity vs. position). How does it compare to the NVE phase space plot? Does it look more “diffusive” or “noisy”?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Plotting NVT (Langevin) Results ---</span>

<span class="c1"># 1. Temperature vs Time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times_nvt</span><span class="p">,</span> <span class="n">temperatures_nvt</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Instantaneous Temperature&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">target_temp_lgv</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Target Temperature (</span><span class="si">{</span><span class="n">target_temp_lgv</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature (kB=1)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NVT (Langevin) SHO: Temperature (gamma=</span><span class="si">{</span><span class="n">gamma</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Optional: Add running average</span>
<span class="n">window_size</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">if</span> <span class="n">n_steps</span> <span class="o">&gt;</span> <span class="n">window_size</span><span class="p">:</span>
    <span class="n">temp_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">temperatures_nvt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">window_size</span><span class="p">)</span><span class="o">/</span><span class="n">window_size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;valid&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times_nvt</span><span class="p">[</span><span class="n">window_size</span><span class="o">-</span><span class="mi">1</span><span class="p">:],</span> <span class="n">temp_avg</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Running Avg (w=</span><span class="si">{</span><span class="n">window_size</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Total Energy vs Time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times_nvt</span><span class="p">,</span> <span class="n">total_energies_nvt</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Total Energy (NVT - Langevin)&quot;</span><span class="p">)</span>
<span class="c1"># plt.plot(times, total_energies, label=&quot;Total Energy (NVE)&quot;, linestyle=&#39;:&#39;) # Comparison</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NVT (Langevin) SHO: Total Energy (gamma=</span><span class="si">{</span><span class="n">gamma</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 3. Phase Space (Velocity vs Position) - NVT Langevin</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions_nvt</span><span class="p">,</span> <span class="n">velocities_nvt</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;NVT (Langevin, T=</span><span class="si">{</span><span class="n">target_temp_lgv</span><span class="si">}</span><span class="s1">, gamma=</span><span class="si">{</span><span class="n">gamma</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="c1"># Compare with NVE</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">velocities</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NVE&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Position&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Velocity&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;NVT (Langevin) vs NVE SHO: Phase Space&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/0f91894d26d717bfb1a22f56d90bdf3c69b1253fca8b0f1e493010cc58973bfa.png" src="../../../_images/0f91894d26d717bfb1a22f56d90bdf3c69b1253fca8b0f1e493010cc58973bfa.png" />
<img alt="../../../_images/18e92d9c2d7fcae112598c934b5c212946958c66a3b786baf8b491bb2afeb5be.png" src="../../../_images/18e92d9c2d7fcae112598c934b5c212946958c66a3b786baf8b491bb2afeb5be.png" />
<img alt="../../../_images/dc463af2783f2d556453167c43b14a00a87ca0ab643147c09d1ddea14f6dd585.png" src="../../../_images/dc463af2783f2d556453167c43b14a00a87ca0ab643147c09d1ddea14f6dd585.png" />
</div>
</div>
</section>
</section>
<section id="lesson-3-3-particle-in-a-double-well-potential-nve">
<h2>Lesson 3.3: Particle in a Double-Well Potential (NVE)<a class="headerlink" href="#lesson-3-3-particle-in-a-double-well-potential-nve" title="Link to this heading">#</a></h2>
<p>Now let’s consider a more interesting potential: the <strong>double-well potential</strong>. This potential has two stable minima separated by an energy barrier. It’s a simple model for systems that can exist in two different states, like chemical reactions or conformational changes.</p>
<p><strong>Potential Energy:</strong>
A common form for the double-well potential is:
$<span class="math notranslate nohighlight">\( V(x) = a x^4 - b x^2 \)</span><span class="math notranslate nohighlight">\(
where \)</span>a<span class="math notranslate nohighlight">\( and \)</span>b$ are positive constants.</p>
<ul class="simple">
<li><p>The <span class="math notranslate nohighlight">\(x^4\)</span> term dominates at large <span class="math notranslate nohighlight">\(|x|\)</span>, confining the particle.</p></li>
<li><p>The <span class="math notranslate nohighlight">\(-x^2\)</span> term creates two minima off-center.</p></li>
</ul>
<p>The minima occur where <span class="math notranslate nohighlight">\(dV/dx = 0\)</span>, which is <span class="math notranslate nohighlight">\(4ax^3 - 2bx = 0\)</span>. This gives <span class="math notranslate nohighlight">\(x=0\)</span> (a local maximum, the barrier top) and <span class="math notranslate nohighlight">\(x = \pm \sqrt{b / (2a)}\)</span> (the two minima).
The height of the energy barrier (relative to the minima) is <span class="math notranslate nohighlight">\(E_{barrier} = V(0) - V(\pm \sqrt{b/(2a)}) = b^2 / (4a)\)</span>.</p>
<p><strong>Force:</strong>
The force is again the negative derivative:
$<span class="math notranslate nohighlight">\( F(x) = -\frac{dV}{dx} = -(4 a x^3 - 2 b x) = -4 a x^3 + 2 b x \)</span>$</p>
<p>We will simulate this system first in the <strong>NVE ensemble</strong>. A key question will be: if we start the particle in one well, does it have enough energy to cross the barrier and explore the other well within our simulation time? This introduces the concept of <strong>sampling</strong> and <strong>rare events</strong>.</p>
<section id="defining-the-double-well-potential-and-force">
<h3>Defining the Double-Well Potential and Force<a class="headerlink" href="#defining-the-double-well-potential-and-force" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">potential_dw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Calculates the potential energy of a double-well potential.&quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">force_dw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;Calculates the force from a double-well potential.&quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span>

<span class="c1"># Parameters for the double-well potential</span>
<span class="n">a_dw</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">b_dw</span> <span class="o">=</span> <span class="mf">4.0</span>

<span class="c1"># Calculate minima and barrier height for reference</span>
<span class="n">minima_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b_dw</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a_dw</span><span class="p">))</span>
<span class="n">minima_val</span> <span class="o">=</span> <span class="n">potential_dw</span><span class="p">(</span><span class="n">minima_pos</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a_dw</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b_dw</span><span class="p">)</span>
<span class="n">barrier_top_val</span> <span class="o">=</span> <span class="n">potential_dw</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a_dw</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b_dw</span><span class="p">)</span>
<span class="n">barrier_height</span> <span class="o">=</span> <span class="n">barrier_top_val</span> <span class="o">-</span> <span class="n">minima_val</span> <span class="c1"># Relative height</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Double-well minima at: +/- </span><span class="si">{</span><span class="n">minima_pos</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (Value: </span><span class="si">{</span><span class="n">minima_val</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Barrier top at x=0 (Value: </span><span class="si">{</span><span class="n">barrier_top_val</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Barrier height (relative to minima): </span><span class="si">{</span><span class="n">barrier_height</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># Plot the potential to visualize</span>
<span class="n">x_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">v_plot</span> <span class="o">=</span> <span class="n">potential_dw</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a_dw</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b_dw</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_plot</span><span class="p">,</span> <span class="n">v_plot</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Position (x)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Potential Energy V(x)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Double-Well Potential&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">minima_val</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">barrier_height</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># Adjust ylim for better view</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">minima_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Minima (-</span><span class="si">{</span><span class="n">minima_pos</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">minima_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Minima (+</span><span class="si">{</span><span class="n">minima_pos</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">barrier_top_val</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Barrier Top&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">minima_val</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Minima Bottom&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Double-well minima at: +/- 1.41 (Value: -4.00)
Barrier top at x=0 (Value: 0.00)
Barrier height (relative to minima): 4.00
</pre></div>
</div>
<img alt="../../../_images/8426b60d65d2a354b3f56e6d027bfe8c9ad6c1bccdfdb9ad89f712ba634cea6f.png" src="../../../_images/8426b60d65d2a354b3f56e6d027bfe8c9ad6c1bccdfdb9ad89f712ba634cea6f.png" />
</div>
</div>
</section>
<section id="coding-exercise-running-the-nve-simulation-for-the-double-well">
<h3>Coding Exercise: Running the NVE Simulation for the Double-Well<a class="headerlink" href="#coding-exercise-running-the-nve-simulation-for-the-double-well" title="Link to this heading">#</a></h3>
<p>Adapt the NVE simulation loop from Lesson 3.1 to use the double-well potential and force functions (<code class="docutils literal notranslate"><span class="pre">potential_dw</span></code>, <code class="docutils literal notranslate"><span class="pre">force_dw</span></code>).</p>
<ul class="simple">
<li><p>Choose initial conditions (<code class="docutils literal notranslate"><span class="pre">x0_dw</span></code>, <code class="docutils literal notranslate"><span class="pre">v0_dw</span></code>) such that the particle starts near one of the minima (e.g., <span class="math notranslate nohighlight">\(x \approx -\sqrt{b/(2a)}\)</span>).</p></li>
<li><p>Ensure the initial total energy is defined. How does the initial total energy compare to the barrier height? Do you expect the particle to cross the barrier?</p></li>
<li><p>Run the simulation and store the trajectory and energies.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- NVE Double-Well Simulation ---</span>

<span class="c1"># Initial conditions for Double Well (start near left minimum)</span>
<span class="n">x0_dw</span> <span class="o">=</span> <span class="o">-</span><span class="n">minima_pos</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="c1"># Start slightly offset from the minimum</span>
<span class="n">v0_dw</span> <span class="o">=</span> <span class="mf">0.5</span>               <span class="c1"># Give it some initial velocity/energy</span>

<span class="c1"># Calculate initial energy - HOW DOES THIS COMPARE TO THE BARRIER HEIGHT?</span>
<span class="n">initial_pe_dw</span> <span class="o">=</span> <span class="n">potential_dw</span><span class="p">(</span><span class="n">x0_dw</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a_dw</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b_dw</span><span class="p">)</span>
<span class="n">initial_ke_dw</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">v0_dw</span><span class="o">**</span><span class="mi">2</span>
<span class="n">initial_total_energy_dw</span> <span class="o">=</span> <span class="n">initial_pe_dw</span> <span class="o">+</span> <span class="n">initial_ke_dw</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial position: </span><span class="si">{</span><span class="n">x0_dw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial velocity: </span><span class="si">{</span><span class="n">v0_dw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Initial Total Energy: </span><span class="si">{</span><span class="n">initial_total_energy_dw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Barrier Height (relative to minima): </span><span class="si">{</span><span class="n">barrier_height</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Energy relative to barrier top: </span><span class="si">{</span><span class="n">initial_total_energy_dw</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">barrier_top_val</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="c1"># Arrays to store results</span>
<span class="n">n_steps_dw</span> <span class="o">=</span> <span class="mi">10000</span> <span class="c1"># May need more steps to see transitions if energy is low</span>
<span class="n">times_dw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps_dw</span><span class="p">)</span>
<span class="n">positions_dw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps_dw</span><span class="p">)</span>
<span class="n">velocities_dw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps_dw</span><span class="p">)</span>
<span class="n">kinetic_energies_dw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps_dw</span><span class="p">)</span>
<span class="n">potential_energies_dw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps_dw</span><span class="p">)</span>
<span class="n">total_energies_dw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_steps_dw</span><span class="p">)</span>

<span class="c1"># Set initial values</span>
<span class="n">positions_dw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0_dw</span>
<span class="n">velocities_dw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0_dw</span>
<span class="n">kinetic_energies_dw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_ke_dw</span>
<span class="n">potential_energies_dw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_pe_dw</span>
<span class="n">total_energies_dw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_total_energy_dw</span>

<span class="c1"># Run the simulation loop (NVE using Velocity Verlet)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps_dw</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># Perform one Verlet step using the double-well force</span>
    <span class="n">x_new</span><span class="p">,</span> <span class="n">v_new</span> <span class="o">=</span> <span class="n">velocity_verlet_step</span><span class="p">(</span>
        <span class="n">positions_dw</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">velocities_dw</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mass</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">force_dw</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a_dw</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b_dw</span>
    <span class="p">)</span>

    <span class="c1"># Store new values</span>
    <span class="n">positions_dw</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_new</span>
    <span class="n">velocities_dw</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_new</span>
    <span class="n">times_dw</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">times_dw</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span>

    <span class="c1"># Calculate and store energies</span>
    <span class="n">kinetic_energies_dw</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">mass</span> <span class="o">*</span> <span class="n">v_new</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">potential_energies_dw</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">potential_dw</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a_dw</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b_dw</span><span class="p">)</span>
    <span class="n">total_energies_dw</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kinetic_energies_dw</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">potential_energies_dw</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NVE Double-Well Simulation finished.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Initial position: -1.31
Initial velocity: 0.50
Initial Total Energy: -3.80
Barrier Height (relative to minima): 4.00
Energy relative to barrier top: -3.80
NVE Double-Well Simulation finished.
</pre></div>
</div>
</div>
</div>
</section>
<section id="analysis-exercise-double-well-nve-results">
<h3>Analysis Exercise: Double-Well NVE Results<a class="headerlink" href="#analysis-exercise-double-well-nve-results" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Plot position vs. time. Does the particle stay in the initial well, or does it cross the barrier to the other well? How often?</p></li>
<li><p>Plot the phase space trajectory (velocity vs. position). What does it look like? Can you identify regions corresponding to the two wells?</p></li>
<li><p>Plot the energies vs. time. Is total energy conserved?</p></li>
<li><p><strong>Discussion:</strong> How does the particle’s behavior depend on its initial total energy relative to the barrier height? What would happen if the initial energy was much lower than the barrier? What if it was significantly higher? (Feel free to change <code class="docutils literal notranslate"><span class="pre">v0_dw</span></code> and re-run the simulation). This illustrates the <strong>sampling problem</strong>: if energy barriers are high relative to the system’s energy/temperature, transitions between states (wells) become <strong>rare events</strong> that are difficult to observe in a standard MD simulation of limited length.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- Plotting Double-Well NVE Results ---</span>

<span class="c1"># 1. Position vs Time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times_dw</span><span class="p">,</span> <span class="n">positions_dw</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Position&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NVE Double-Well: Position vs Time (Initial E = </span><span class="si">{</span><span class="n">initial_total_energy_dw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">minima_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Minima&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">minima_pos</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Phase Space (Velocity vs Position)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">positions_dw</span><span class="p">,</span> <span class="n">velocities_dw</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># Use dots for dense trajectory</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Position&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Velocity&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NVE Double-Well: Phase Space (Initial E = </span><span class="si">{</span><span class="n">initial_total_energy_dw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 3. Energies vs Time</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times_dw</span><span class="p">,</span> <span class="n">kinetic_energies_dw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Kinetic Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times_dw</span><span class="p">,</span> <span class="n">potential_energies_dw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Potential Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times_dw</span><span class="p">,</span> <span class="n">total_energies_dw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Total Energy&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Energy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NVE Double-Well: Energy Conservation (Initial E = </span><span class="si">{</span><span class="n">initial_total_energy_dw</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Optional: Plot energy relative to barrier top</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">barrier_top_val</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Barrier Top E&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/9b886c8dc411b54edbc05a26b40b3d9ee56eb0b5afa781e637e7732c780b6fd0.png" src="../../../_images/9b886c8dc411b54edbc05a26b40b3d9ee56eb0b5afa781e637e7732c780b6fd0.png" />
<img alt="../../../_images/583149608e52e81a3cdab122d9dc4f4087647caf443eb002d54e0f7dcbb2e526.png" src="../../../_images/583149608e52e81a3cdab122d9dc4f4087647caf443eb002d54e0f7dcbb2e526.png" />
<img alt="../../../_images/026867951de0aabcb2b5e86c48b04094587e890922bb7d37c3b31b8dc1bf971e.png" src="../../../_images/026867951de0aabcb2b5e86c48b04094587e890922bb7d37c3b31b8dc1bf971e.png" />
</div>
</div>
<hr class="docutils" />
<p>End of Module 4. We have successfully implemented our first MD simulations in Python!</p>
<ul class="simple">
<li><p>We simulated a particle in a Simple Harmonic potential using the Velocity Verlet algorithm in the NVE ensemble and observed energy conservation.</p></li>
<li><p>We added a <strong>Langevin thermostat</strong> using the velocity verlet integrator to control temperature and simulate the SHO in the NVT ensemble, observing temperature fluctuations around the target and non-conservation of total energy.</p></li>
<li><p>We simulated a particle in a Double-Well potential (NVE) and encountered the <strong>sampling problem</strong> associated with energy barriers and rare events.</p></li>
</ul>
<p>This last point directly motivates the need for the <strong>enhanced sampling techniques</strong> we will explore starting in Module 4, which are designed to overcome such barriers and efficiently explore complex energy landscapes, often in conjunction with a thermostat like Langevin dynamics.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "YOUR_USERNAME/YOUR_REPO",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./_build/jupyter_execute/notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-importing-libraries">Setup: Importing Libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lesson-3-1-particle-in-a-simple-harmonic-potential-nve">Lesson 3.1: Particle in a Simple Harmonic Potential (NVE)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-potential-and-force-functions">Defining the Potential and Force Functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-the-velocity-verlet-integrator">Implementing the Velocity Verlet Integrator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-simulation-parameters-and-initial-conditions">Setting Simulation Parameters and Initial Conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-exercise-running-the-nve-simulation-loop">Coding Exercise: Running the NVE Simulation Loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-exercise-plotting-the-results">Analysis Exercise: Plotting the Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lesson-3-2-adding-temperature-control-nvt-with-langevin-dynamics">Lesson 3.2: Adding Temperature Control (NVT) with Langevin Dynamics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementing-temperature-calculation-and-langevin-integrator">Implementing Temperature Calculation and Langevin Integrator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-exercise-running-the-nvt-simulation-loop-langevin">Coding Exercise: Running the NVT Simulation Loop (Langevin)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-exercise-nvt-langevin-simulation-results">Analysis Exercise: NVT (Langevin) Simulation Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lesson-3-3-particle-in-a-double-well-potential-nve">Lesson 3.3: Particle in a Double-Well Potential (NVE)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-the-double-well-potential-and-force">Defining the Double-Well Potential and Force</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-exercise-running-the-nve-simulation-for-the-double-well">Coding Exercise: Running the NVE Simulation for the Double-Well</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-exercise-double-well-nve-results">Analysis Exercise: Double-Well NVE Results</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Your Name
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>